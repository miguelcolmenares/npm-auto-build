# NPM Auto Build GitHub Action

[![GitHub release (latest by date)](https://img.shields.io/github/v/release/miguelcolmenares/npm-auto-build)](https://github.com/miguelcolmenares/npm-auto-build/releases)
[![GitHub](https://img.shields.io/github/license/miguelcolmenares/npm-auto-build)](LICENSE)

ğŸš€ **Automatically build and commit your npm project's build files to your repository**

This GitHub Action runs your npm build script and automatically commits the generated build files to your repository. Perfect for keeping your source code clean while maintaining compiled assets for deployment or distribution.

## âœ¨ Features

- ğŸ”§ **Configurable build command** - Use any npm script (defaults to `build`)
- ğŸ“ **Smart build directory detection** - Automatically finds common build directories
- ğŸ¤– **Automatic Git handling** - Configures Git and commits changes with proper authentication
- ğŸ“¦ **Multiple package managers** - Works with npm and yarn
- ğŸ¯ **Zero configuration** - Works out of the box with sensible defaults
- ğŸ” **Detailed logging** - Clear feedback about the build process

## ğŸš€ Quick Start

### Basic Usage

```yml
name: Auto Build
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Auto Build
        uses: miguelcolmenares/npm-auto-build@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
```

### Advanced Usage

```yml
name: Advanced Auto Build
on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Auto Build
        uses: miguelcolmenares/npm-auto-build@v1
        with:
          command: 'build:prod'
          directory: './frontend'
          build-dir: 'dist'
          commit-message: 'chore: update production build'
          github-token: ${{ secrets.GITHUB_TOKEN }}
          git-user-name: 'Build Bot'
          git-user-email: 'bot@mycompany.com'
          node-version: '18'
```

## ğŸ“– Inputs

| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| `command` | NPM script to run | No | `build` |
| `directory` | Directory containing package.json | No | `.` |
| `build-dir` | Directory where build files are generated | No | `dist` |
| `commit-message` | Commit message for build changes | No | `chore: update build files` |
| `github-token` | GitHub token for authentication | **Yes** | - |
| `git-user-name` | Git user name for commits | No | `github-actions[bot]` |
| `git-user-email` | Git user email for commits | No | `github-actions[bot]@users.noreply.github.com` |
| `node-version` | Node.js version to use | No | `18` |

## ğŸ¯ Use Cases

### 1. **Frontend Deployment**
Perfect for React, Vue, Angular, or any frontend framework that generates static files for deployment.

### 2. **Library Distribution**
Build and commit transpiled JavaScript for npm package distribution without including source build in your development workflow.

### 3. **Documentation Sites**
Generate and deploy documentation sites (like with VuePress, GitBook, etc.) automatically.

### 4. **Static Site Generation**
Build and commit static sites generated by tools like Gatsby, Next.js, Nuxt.js, etc.

## ğŸ”§ Configuration Examples

### React Application
```yml
- name: Build React App
  uses: miguelcolmenares/npm-auto-build@v1
  with:
    command: 'build'
    build-dir: 'build'
    commit-message: 'chore: update React build'
    github-token: ${{ secrets.GITHUB_TOKEN }}
```

### Vue.js Application
```yml
- name: Build Vue App
  uses: miguelcolmenares/npm-auto-build@v1
  with:
    command: 'build'
    build-dir: 'dist'
    github-token: ${{ secrets.GITHUB_TOKEN }}
```

### TypeScript Library
```yml
- name: Build TypeScript Library
  uses: miguelcolmenares/npm-auto-build@v1
  with:
    command: 'build'
    build-dir: 'lib'
    commit-message: 'chore: update compiled TypeScript'
    github-token: ${{ secrets.GITHUB_TOKEN }}
```

### Monorepo Setup
```yml
- name: Build Frontend Package
  uses: miguelcolmenares/npm-auto-build@v1
  with:
    directory: './packages/frontend'
    command: 'build:prod'
    build-dir: 'dist'
    github-token: ${{ secrets.GITHUB_TOKEN }}
```

## ğŸ”’ Permissions

Make sure your workflow has the necessary permissions:

```yml
permissions:
  contents: write  # Required to commit changes
  actions: read    # Required to read workflow info
```

Or use a Personal Access Token with `contents:write` permission.

## ğŸ› ï¸ How It Works

1. **Checkout** - The action starts in your repository workspace
2. **Dependency Installation** - Automatically detects and installs npm/yarn dependencies
3. **Build Execution** - Runs your specified npm build command
4. **Build Detection** - Finds the build directory (auto-detects common locations)
5. **Git Configuration** - Sets up Git with provided credentials
6. **Change Detection** - Checks if build files have changed
7. **Commit & Push** - Commits and pushes changes if any are found

## ğŸ¤” Why Use This Action?

### Problems It Solves:
- âŒ **Large repositories** due to committed build files
- âŒ **Merge conflicts** in build files
- âŒ **Inconsistent builds** across different environments
- âŒ **Forgotten builds** when making releases

### Benefits:
- âœ… **Clean repository** - Keep source and build separate
- âœ… **Automated builds** - Never forget to build before release
- âœ… **Consistent environment** - Builds always happen in CI
- âœ… **Reduced conflicts** - No more build file merge conflicts

## ğŸ“ Requirements

- Repository with `package.json`
- npm build script defined in `package.json`
- GitHub token with write permissions

## ğŸ› Troubleshooting

### Build Directory Not Found
If you get "No build directory found", specify the correct `build-dir`:
```yml
with:
  build-dir: 'public'  # or 'out', 'lib', etc.
```

### Permission Denied
Make sure your token has the `contents:write` permission:
```yml
permissions:
  contents: write
```

### No Changes to Commit
This is normal if your build output hasn't changed. The action will exit successfully without making a commit.

## ï¿½ Testing Locally

You can test this action locally using Docker:

```bash
# Quick test with defaults
./test.sh

# Test with custom parameters
./test.sh "build:prod" "build" "./my-project"
```

For more testing options, see [TESTING.md](TESTING.md).

## ï¿½ğŸ¤ Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ğŸ‘¨â€ğŸ’» Author

**Miguel Colmenares**
- GitHub: [@miguelcolmenares](https://github.com/miguelcolmenares)
- Email: me@miguelcolmenares.com